name: Push Email Notification

on:
  push:
    branches:
      - main 

jobs:
  send_email:
    runs-on: ubuntu-latest

    steps:


      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Extract commit info
        id: commit
        run: |
          # 제목, 본문
          SUBJECT="$(git log -1 --pretty=%s)"
          BODY="$(git log -1 --pretty=%b)"

          echo "Full Subject: $SUBJECT"
          echo "Body: $BODY"

          # 접수와 구분
          if [[ "$SUBJECT" == reception_alert:* ]]; then
            CLEAN_SUBJECT="${SUBJECT#reception_alert:}"   # 구분값 날림.
            echo "mail_subject=$CLEAN_SUBJECT" >> $GITHUB_OUTPUT

            echo "mail_body=$BODY" >> $GITHUB_OUTPUT
            echo "match=Y" >> $GITHUB_OUTPUT
          else
            echo "match=N" >> $GITHUB_OUTPUT

          fi




      - name: Send mail on push
        if: steps.commit.outputs.match == 'Y'
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: ${{ secrets.SMTP_HOST }}
          server_port: ${{ secrets.SMTP_PORT }}
          username: ${{ secrets.SMTP_USERNAME }}
          password: ${{ secrets.SMTP_PASSWORD }}
          subject: "${{ steps.commit.outputs.mail_subject }}___${{ steps.commit.outputs.match }}--"
          to: "quristyle@gmail.com" #, uspuni@gmail.com, utmost793@daum.net, anstnwl27@gmail.com, a0624z@naver.com "
          from: "hjmaintenance"
          html_body: ${{ steps.commit.outputs.mail_body }}