@using MIT.Razor.Pages.Component
@using MIT.Razor.Pages.Component.DataEdits
@using MIT.Razor.Pages.Component.DataEdits.Data
@using System.Data
@using MIT.Razor.Pages.Service
@using MIT.UI.LIB.DataEdits.Data

@inherits CommonImageComboBoxUIComponentBase

<CommonImageComboBox @ref="@ComboBox"
                     ValueFieldName="@ValueFieldName"
                     DisplayFieldName="@DisplayFieldName"
                     IsShowEmptyRow="@IsShowEmptyRow"
                     EmptyRowName="@EmptyRowName"
                     IsFirstRowSelected="@IsFirstRowSelected"
                     ValueChanged="@((ImageComboBoxData? item) => OnValueChanged(item))">

</CommonImageComboBox>

@code {
    [Parameter]
    public string DisplayFieldName { get; set; } = "CODE_NAME";
    [Parameter]
    public string ValueFieldName { get; set; } = "CODE";

    [Parameter]
    public string GroupCode { get; set; } = string.Empty;
    [Parameter]
    public string CodeName { get; set; } = string.Empty;
    [Parameter]
    public string OPT01 { get; set; } = string.Empty;
    [Parameter]
    public string OPT02 { get; set; } = string.Empty;
    [Parameter]
    public string OPT03 { get; set; } = string.Empty;
    [Parameter]
    public string OPT04 { get; set; } = string.Empty;
    [Parameter]
    public string OPT05 { get; set; } = string.Empty;
    [Parameter]
    public string QueryName { get; set; } = "SP_COMBO_COM_CODE_SELECT";

    public override async Task LoadData()
    {
        if (ComboBox != null)
            ComboBox.DataSource = await DBSearch();
    }

    #region [ 데이터 정의 메소드 ]

    private async Task<DataTable?> DBSearch()
    {
        if (QueryService == null)
            throw new Exception("QueryService가 Null 입니다.");

        if (QueryName == null)
            throw new Exception("QueryName의 값이 없습니다.");

        var datatable = await QueryService.ExecuteDatatableAsync(QueryName, new Dictionary<string, object?>()
        {
            { "PARENT_CODE", GroupCode },
            { "CODE_NAME", CodeName },
            { "OPT01", OPT01 },
            { "OPT02", OPT02 },
            { "OPT03", OPT03 },
            { "OPT04", OPT04 },
            { "OPT05", OPT05 },
        });

        return datatable;
    }

    #endregion [ 데이터 정의 메소드 ]
}
