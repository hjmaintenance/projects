@using MIT.Razor.Pages.Component
@using MIT.Razor.Pages.Component.DataEdits
@using MIT.Razor.Pages.Component.DataEdits.Data
@using System.Data
@using MIT.Razor.Pages.Service
@using MIT.UI.LIB.DataEdits.Data

@inherits CommonImageComboBoxUIComponentBase

<CommonImageComboBox @ref="@ComboBox"
                     ValueFieldName="@ValueFieldName"
                     DisplayFieldName="@DisplayFieldName"
                     IsShowEmptyRow="@IsShowEmptyRow"
                     EmptyRowName="@EmptyRowName"
                     IsFirstRowSelected="@IsFirstRowSelected"
                     ValueChanged="@((ImageComboBoxData? item) => OnValueChanged(item))">

</CommonImageComboBox>

@code {
    [Parameter]
    public string DisplayFieldName { get; set; } = "CODE_NAME";
    [Parameter]
    public string ValueFieldName { get; set; } = "CODE";

    [Parameter]
    public string Gubun { get; set; } = string.Empty;
    [Parameter]
    public string Val1 { get; set; } = string.Empty;
    [Parameter]
    public string Val2 { get; set; } = string.Empty;
    [Parameter]
    public string Val3 { get; set; } = string.Empty;
    [Parameter]
    public string Val4 { get; set; } = string.Empty;
    [Parameter]
    public string Val5 { get; set; } = string.Empty;
    [Parameter]
    public string QueryName { get; set; } = "SP_COMBO_COMMON_S";

    public override async Task LoadData()
    {
        if (ComboBox != null)
            ComboBox.DataSource = await DBSearch();
    }

    #region [ 데이터 정의 메소드 ]

    private async Task<DataTable?> DBSearch()
    {
        if (QueryService == null)
            throw new Exception("QueryService가 Null 입니다.");

        if (QueryName == null)
            throw new Exception("QueryName의 값이 없습니다.");

        var datatable = await QueryService.ExecuteDatatableAsync(QueryName, new Dictionary<string, object?>()
        {
            { "GUBUN", Gubun },
            { "VAL1", Val1 },
            { "VAL2", Val2 },
            { "VAL3", Val3 },
            { "VAL4", Val4 },
            { "VAL5", Val5 },
        });

        return datatable;
    }

    #endregion [ 데이터 정의 메소드 ]
}
