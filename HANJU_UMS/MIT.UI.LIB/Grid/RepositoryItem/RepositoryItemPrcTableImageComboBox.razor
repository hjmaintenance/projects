@using MIT.Razor.Pages.Component.Grid.RepositoryItem
@using System.Data

@inherits RepositoryItemImageComboBox

<RepositoryItemImageComboBox DisplayFieldName="@DisplayFieldName"
                             ValueFieldName="@ValueFieldName"
                             AllowEdit="@AllowEdit"
                             IsPrimaryKey="@IsPrimaryKey"
                             ReadOnly="@ReadOnly"
                             Enable="@Enable"
                             DataSource="@DataSource"
                             ValueChanged="@ValueChanged"
                             CellContext="CellContext">
</RepositoryItemImageComboBox>

@code {


    #region [조회조건]

    #endregion [조회조건]

    [Parameter]
    public string QueryName { get; set; } = "SP_COMBO_COM_PRC_TABLE_SELECT";


    protected override async Task OnInitializedAsync()
    {
        base.OnInitialized();

        DisplayFieldName = "TB_NAME";
        ValueFieldName = "TB_ID";

        await LoadData();
    }

    public async Task LoadData()
    {
        DataSource = await DBSearch();
        StateHasChanged();
    }

    #region [ 데이터 정의 메소드 ]

    private async Task<DataTable?> DBSearch()
    {
        if (QueryService == null)
            throw new Exception("QueryService가 Null 입니다.");

        if (QueryName == null)
            throw new Exception("QueryName의 값이 없습니다.");

        var datatable = await QueryService.ExecuteDatatableAsync(QueryName, new Dictionary<string, object?>()
        {
        });

        return datatable;
    }

    #endregion [ 데이터 정의 메소드 ]
}
