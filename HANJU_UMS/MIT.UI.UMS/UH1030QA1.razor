@{
    /*
    * 작성자명 : 김지수
    * 작성일자 : 25-01-22
    * 최종수정 : 25-02-11
    * 화면명 : 업체별 순시량 모니터링 현황
     * 프로시저 : P_HMI_ELEC_REAL_USE_QTY_MNTR
    */
}

@using MIT.Razor.Pages
@using MIT.Razor.Pages.Common
@using MIT.Razor.Pages.Component.DataEdits
@using MIT.Razor.Pages.Component.Grid
@using MIT.Razor.Pages.Component.Grid.RepositoryItem
@using static MIT.Razor.Pages.TrendCode
@inherits UH1030QA1Base

@code{
    string MDateFormat = "yyyy-MM-dd HH:mm";
}

<DxFormLayout CssClass="w-100">
     @{ /* search area */ }
    <DxFormLayoutGroup Caption="조회조건" CssClass="mit-search-area" Decoration="FormLayoutGroupDecoration.Card" ColSpanSm="12">
        <DxFormLayoutItem Caption="비교일자" ColSpanSm="3"><CommonDateEdit @ref="@CompDate"/></DxFormLayoutItem>
    </DxFormLayoutGroup>

    @{ /* content area */ }
    <DxFormLayoutGroup Caption="업체별 순시량 모니터링 현황" CssClass="mit-content-area" Decoration="FormLayoutGroupDecoration.Card" ColSpanSm="12">
        <DxFormLayoutItem ColSpanSm="12">
            <CommonGrid @ref="Grd1" CssClass="setting-program-grid mit-grid" IsExportDocEnabled=false
            IsExportImageEnabled=false
            IsExportPDFEnabled=false
            IsExportXlsxEnabled=false
                        ExportFileName="전기 업체별 모니터링 현황"
            IsShowToolBar=true>

                <DataColumnsTemplate>
                    <DxGridDataColumn Caption="회사명" GroupIndex="0" FieldName="COM_NAME"TextAlignment="GridTextAlignment.Center" CaptionAlignment="GridTextAlignment.Center"><CellDisplayTemplate Context="context2"><RepositoryItemTextBox CellContext="context2" ReadOnly="true" /></CellDisplayTemplate></DxGridDataColumn>
                    <DxGridDataColumn Caption="FDR별" FieldName="MC_ID" TextAlignment="GridTextAlignment.Center" CaptionAlignment="GridTextAlignment.Center"><CellDisplayTemplate Context="context2"><RepositoryItemTextBox CellContext="context2" ReadOnly="true" /></CellDisplayTemplate></DxGridDataColumn>
                    @{
                        DateTime now = DateTime.Now;
                        DateTime compDate = SearchedDate.AddHours(now.Hour).AddMinutes(now.Minute).AddSeconds(now.Second);
                    }
                    <DxGridBandColumn Caption="@($"당일({now.ToString(MDateFormat)})")" CaptionAlignment="GridTextAlignment.Center">
                        <Columns>
                            <DxGridDataColumn Caption="1공장" FieldName="S01" CaptionAlignment="GridTextAlignment.Center" TextAlignment="GridTextAlignment.Right"><CellDisplayTemplate Context="context2"><RepositoryItemSpinEdit CellContext="context2" ReadOnly="true" DisplayFormat="N0"/></CellDisplayTemplate></DxGridDataColumn>
                            <DxGridDataColumn Caption="2공장" FieldName="S02" CaptionAlignment="GridTextAlignment.Center" TextAlignment="GridTextAlignment.Right"><CellDisplayTemplate Context="context2"><RepositoryItemSpinEdit CellContext="context2" ReadOnly="true" DisplayFormat="N0" /></CellDisplayTemplate></DxGridDataColumn>
                            <DxGridDataColumn Caption="3공장" FieldName="S03" CaptionAlignment="GridTextAlignment.Center" TextAlignment="GridTextAlignment.Right"><CellDisplayTemplate Context="context2"><RepositoryItemSpinEdit CellContext="context2" ReadOnly="true" DisplayFormat="N0" /></CellDisplayTemplate></DxGridDataColumn>
                        </Columns>
                    </DxGridBandColumn>
                    <DxGridBandColumn Caption="@($"비교일({compDate.ToString(MDateFormat)})")" CaptionAlignment="GridTextAlignment.Center">
                        <Columns>
                            <DxGridDataColumn Caption="1공장" FieldName="T01" CaptionAlignment="GridTextAlignment.Center" TextAlignment="GridTextAlignment.Right"><CellDisplayTemplate Context="context2"><RepositoryItemSpinEdit CellContext="context2" ReadOnly="true" DisplayFormat="N0" /></CellDisplayTemplate></DxGridDataColumn>
                            <DxGridDataColumn Caption="2공장" FieldName="T02" CaptionAlignment="GridTextAlignment.Center" TextAlignment="GridTextAlignment.Right"><CellDisplayTemplate Context="context2"><RepositoryItemSpinEdit CellContext="context2" ReadOnly="true" DisplayFormat="N0" /></CellDisplayTemplate></DxGridDataColumn>
                            <DxGridDataColumn Caption="3공장" FieldName="T03" CaptionAlignment="GridTextAlignment.Center" TextAlignment="GridTextAlignment.Right"><CellDisplayTemplate Context="context2"><RepositoryItemSpinEdit CellContext="context2" ReadOnly="true" DisplayFormat="N0" /></CellDisplayTemplate></DxGridDataColumn>
                        </Columns>
                    </DxGridBandColumn>
                    <DxGridBandColumn Caption="차이(당일-비교일)" CaptionAlignment="GridTextAlignment.Center">
                        <Columns>
                            <DxGridDataColumn Caption="1공장" FieldName="COMP01" CaptionAlignment="GridTextAlignment.Center" TextAlignment="GridTextAlignment.Right"><CellDisplayTemplate Context="context2"><RepositoryItemSpinEdit CellContext="context2" ReadOnly="true" DisplayFormat="N0" /></CellDisplayTemplate></DxGridDataColumn>
                            <DxGridDataColumn Caption="2공장" FieldName="COMP02" CaptionAlignment="GridTextAlignment.Center" TextAlignment="GridTextAlignment.Right"><CellDisplayTemplate Context="context2"><RepositoryItemSpinEdit CellContext="context2" ReadOnly="true" DisplayFormat="N0" /></CellDisplayTemplate></DxGridDataColumn>
                            <DxGridDataColumn Caption="3공장" FieldName="COMP03" CaptionAlignment="GridTextAlignment.Center" TextAlignment="GridTextAlignment.Right"><CellDisplayTemplate Context="context2"><RepositoryItemSpinEdit CellContext="context2" ReadOnly="true" DisplayFormat="N0" /></CellDisplayTemplate></DxGridDataColumn>
                        </Columns>
                    </DxGridBandColumn>                
                </DataColumnsTemplate>
            </CommonGrid>
        </DxFormLayoutItem>
    </DxFormLayoutGroup>
</DxFormLayout>

<style>

</style>

@code {
    private void OnRowDoubleClick(GridRowClickEventArgs e)
    {
        if (CommonPopupService != null)
        {
            // 소계 합계는 눌러도 안나오게..
            var com_name = (e.Grid.GetRowValue(e.VisibleIndex, "COM_NAME") + "");
            if (com_name == "합 계") return;

            // mc..
            var mc_id = (e.Grid.GetRowValue(e.VisibleIndex, "MC_ID") + "");

            TrendCode tc = new TrendCode() { ComId = com_name, FdrId = mc_id, CompreDate = SearchedDate};
            CommonPopupService.Show(typeof(UH1070QA1_POP), "Trend View", Width: 1280, Height: 740, Parameter: tc, CloseCallback: OnCloseCallback);
        }
    }


    protected async Task OnCloseCallback(PopupResult result)
    {
        if (result.PopupResultType != PopupResultType.OK) return;
        await Task.Delay(1);

    }





}