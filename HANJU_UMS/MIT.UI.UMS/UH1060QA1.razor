@{
    /*
  * 작성자명 : 김지수
  * 작성일자 : 25-01-23
  * 최종수정 : 25-02-11
  * 화명명 : 용수 계량기별 모니터링 현황
       * 프로시저 : P_HMI_WATER_DW_MACH_MNTR_SELECT01, P_HMI_WATER_FW_MACH_MNTR_SELECT01, P_HMI_WATER_DWFW_MACH_MNTR_SELECT01_V01
      */
}

@using MIT.Razor.Pages
@using MIT.Razor.Pages.Common
@using MIT.Razor.Pages.Component.Grid
@using MIT.Razor.Pages.Component.Grid.RepositoryItem
@using static MIT.Razor.Pages.TrendCode
@inherits UH1060QA1Base


<DxFormLayout CssClass="w-100">

    @{ /* content area */ }
    <DxFormLayoutGroup CssClass="mit-content-area" Decoration="FormLayoutGroupDecoration.Card" ColSpanSm="12">
    <DxFormLayoutGroup Caption="순수 여과수 모니터링 현황" Decoration="FormLayoutGroupDecoration.Card" ColSpanSm="12">
        <DxFormLayoutItem ColSpanSm="12">
                <CommonGrid @ref="Grd1" CssClass="setting-program-grid mit-grid" RowDoubleClick="OnRowDoubleClick">
                    <DataColumnsTemplate> 
                        <DxGridDataColumn Caption="구분"  FieldName="COM_MC" Name="COM_MC" TextAlignment="GridTextAlignment.Center" CaptionAlignment="GridTextAlignment.Center" MinWidth="160" ><CellDisplayTemplate Context="context2"><RepositoryItemTextBox CellContext="context2" ReadOnly="true"/></CellDisplayTemplate ></DxGridDataColumn>
                        <DxGridBandColumn Caption="순수" Name="DW" CaptionAlignment="GridTextAlignment.Center">
                          <Columns>
                               <DxGridDataColumn Caption="순시(T/H)" FieldName="S01" Name="S01" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center" MinWidth="80">
                                  <CellDisplayTemplate Context="context2">
                                      @if (context2.GetRowValue("Maintenance_YN") + "" == "Y")
                                      {
                                          <span class="badge bg-danger mit-maintenance-text">점검중</span>
                                      }
                                      else
                                      {
                                          <RepositoryItemSpinEdit ReadOnly="true" CellContext="context2" DisplayFormat="N1" />
                                      }
                                  </CellDisplayTemplate>
                              </DxGridDataColumn>
                              <DxGridDataColumn Caption="일(TON)" FieldName="S02" Name="S02" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center" MinWidth="80">
                                  <CellDisplayTemplate Context="context2">
                                      @if (context2.GetRowValue("Maintenance_YN") + "" == "Y")
                                      {
                                          <span class="badge bg-danger mit-maintenance-text">점검중</span>
                                      }
                                      else
                                      {
                                          <RepositoryItemSpinEdit ReadOnly="true" CellContext="context2" DisplayFormat="N1" />
                                      }
                                  </CellDisplayTemplate>
                              </DxGridDataColumn>
                              <DxGridDataColumn Caption="일(T/D)" FieldName="S03" Name="S03" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center" MinWidth="80">
                                  <CellDisplayTemplate Context="context2">
                                      @if (context2.GetRowValue("Maintenance_YN") + "" == "Y")
                                      {
                                          <span class="badge bg-danger mit-maintenance-text">점검중</span>
                                      }
                                      else
                                      {
                                          <RepositoryItemSpinEdit ReadOnly="true" CellContext="context2" DisplayFormat="N1" />
                                      }
                                  </CellDisplayTemplate>
                              </DxGridDataColumn>
                              <DxGridDataColumn Caption="월(TON)" FieldName="S04" Name="S04" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center" MinWidth="80">
                                  <CellDisplayTemplate Context="context2">
                                      @if (context2.GetRowValue("Maintenance_YN") + "" == "Y")
                                      {
                                          <span class="badge bg-danger mit-maintenance-text">점검중</span>
                                      }
                                      else
                                      {
                                          <RepositoryItemSpinEdit ReadOnly="true" CellContext="context2" DisplayFormat="N1" />
                                      }
                                  </CellDisplayTemplate>
                              </DxGridDataColumn>
                              <DxGridDataColumn Caption="월(T/D)" FieldName="S05" Name="S05" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center" MinWidth="80">
                                  <CellDisplayTemplate Context="context2">
                                      @if (context2.GetRowValue("Maintenance_YN") + "" == "Y")
                                      {
                                          <span class="badge bg-danger mit-maintenance-text">점검중</span>
                                      }
                                      else
                                      {
                                          <RepositoryItemSpinEdit ReadOnly="true" CellContext="context2" DisplayFormat="N1" />
                                      }
                                  </CellDisplayTemplate>
                              </DxGridDataColumn>
                              @*고객사 요청으로 적산량 삭제, 나중에 쓸꺼면 주석풀고사용 : 시안 화면 수정 건 (250310).pptx*@
                              @* <DxGridDataColumn Caption="적산량" FieldName="S06" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center" MinWidth="105"><CellDisplayTemplate Context="context2"><RepositoryItemSpinEdit CellContext="context2" ReadOnly="true" DisplayFormat="N3" /></CellDisplayTemplate></DxGridDataColumn> *@
                              <DxGridDataColumn Caption="PEAK" FieldName="S07" Name="S07" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center" MinWidth="50">
                                  <CellDisplayTemplate Context="context2">
                                      @if (context2.GetRowValue("Maintenance_YN") + "" == "Y")
                                      {
                                          <span class="badge bg-danger mit-maintenance-text">점검중</span>
                                      }
                                      else
                                      {
                                          <RepositoryItemSpinEdit ReadOnly="true" CellContext="context2" DisplayFormat="N1" />
                                      }
                                  </CellDisplayTemplate>
                              </DxGridDataColumn>
                              </Columns>
                         </DxGridBandColumn>

                         <DxGridBandColumn Caption="여과수" Name="FW" CaptionAlignment="GridTextAlignment.Center">
                                <Columns>
                          
                              <DxGridDataColumn Caption="순시(T/H)" FieldName="S08" Name="S08" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center" MinWidth="80">
                                <CellDisplayTemplate Context="context2">
                                  @if (context2.GetRowValue("Maintenance_YN") + "" == "Y") {
                                    <span class="badge bg-danger mit-maintenance-text">점검중</span>
                                  }
                                  else {
                                    <RepositoryItemSpinEdit ReadOnly="true" CellContext="context2" DisplayFormat="N1" />
                                  }
                                </CellDisplayTemplate>
                              </DxGridDataColumn>
                              <DxGridDataColumn Caption="일(TON)" FieldName="S09" Name="S09" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center" MinWidth="80">
                                <CellDisplayTemplate Context="context2">
                                  @if (context2.GetRowValue("Maintenance_YN") + "" == "Y") {
                                    <span class="badge bg-danger mit-maintenance-text">점검중</span>
                                  }
                                  else {
                                    <RepositoryItemSpinEdit ReadOnly="true" CellContext="context2" DisplayFormat="N1" />
                                  }
                                </CellDisplayTemplate>
                              </DxGridDataColumn>
                              <DxGridDataColumn Caption="일(T/D)" FieldName="S10" Name="S10" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center" MinWidth="80">
                                <CellDisplayTemplate Context="context2">
                                  @if (context2.GetRowValue("Maintenance_YN") + "" == "Y") {
                                    <span class="badge bg-danger mit-maintenance-text">점검중</span>
                                  }
                                  else {
                                    <RepositoryItemSpinEdit ReadOnly="true" CellContext="context2" DisplayFormat="N1" />
                                  }
                                </CellDisplayTemplate>
                              </DxGridDataColumn>
                              <DxGridDataColumn Caption="월(TON)" FieldName="S11" Name="S11" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center" MinWidth="80">
                                <CellDisplayTemplate Context="context2">
                                  @if (context2.GetRowValue("Maintenance_YN") + "" == "Y") {
                                    <span class="badge bg-danger mit-maintenance-text">점검중</span>
                                  }
                                  else {
                                    <RepositoryItemSpinEdit ReadOnly="true" CellContext="context2" DisplayFormat="N1" />
                                  }
                                </CellDisplayTemplate>
                              </DxGridDataColumn>
                              <DxGridDataColumn Caption="월(T/D)" FieldName="S12" Name="S12" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center" MinWidth="80">
                                <CellDisplayTemplate Context="context2">
                                  @if (context2.GetRowValue("Maintenance_YN") + "" == "Y") {
                                    <span class="badge bg-danger mit-maintenance-text">점검중</span>
                                  }
                                  else {
                                    <RepositoryItemSpinEdit ReadOnly="true" CellContext="context2" DisplayFormat="N1" />
                                  }
                                </CellDisplayTemplate>
                              </DxGridDataColumn>
                              @*고객사 요청으로 적산량 삭제, 나중에 쓸꺼면 주석풀고사용 : 시안 화면 수정 건 (250310).pptx*@
                              @* <DxGridDataColumn Caption="적산량" FieldName="S13" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center" MinWidth="105"><CellDisplayTemplate Context="context2"><RepositoryItemSpinEdit CellContext="context2" ReadOnly="true" DisplayFormat="N3" /></CellDisplayTemplate></DxGridDataColumn> *@
                              <DxGridDataColumn Caption="PEAK" FieldName="S14" Name="S14" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center" MinWidth="50">
                                <CellDisplayTemplate Context="context2">
                                  @if (context2.GetRowValue("Maintenance_YN") + "" == "Y") {
                                    <span class="badge bg-danger mit-maintenance-text">점검중</span>
                                  }
                                  else {
                                    <RepositoryItemSpinEdit ReadOnly="true" CellContext="context2" DisplayFormat="N1" />
                                  }
                                </CellDisplayTemplate>
                              </DxGridDataColumn>
                            </Columns>
                          </DxGridBandColumn>
                    </DataColumnsTemplate>
                </CommonGrid>
        </DxFormLayoutItem>
    </DxFormLayoutGroup>
    </DxFormLayoutGroup>
</DxFormLayout>

<style>
</style>
@code {
    private void OnRowDoubleClick(GridRowClickEventArgs e)
    {
        if (CommonPopupService != null)
        {
            // 소계 합계는 눌러도 안나오게..
            var COM_MC = (e.Grid.GetRowValue(e.VisibleIndex, "COM_MC") + "");
            //string[] excludedNames = { "순수계", "입주사계", "제염 응축수", "제염소계", "여과수 계" };
            string[] excludedNames = { "입주사계", "제염소계", "합계" };
            if (excludedNames.Contains(COM_MC)) return;

            // com_id
            var com_id = (e.Grid.GetRowValue(e.VisibleIndex, "COM_ID") + "");

            // mc..
            var mc_id = (e.Grid.GetRowValue(e.VisibleIndex, "MC_ID") + "");
            var dw_mc_id = (e.Grid.GetRowValue(e.VisibleIndex, "DW_MC_ID") + "");
            var fw_mc_id = (e.Grid.GetRowValue(e.VisibleIndex, "FW_MC_ID") + "");
            //column 분기
            

            TrendCode tc = new TrendCode() { ComId = com_id, FdrId = mc_id, GaugeType = GAUGE_TYPE.WA};
            //TrendCode tc = new TrendCode() { ComId = "STAC", FdrId = "STAC_HP", GaugeType = GAUGE_TYPE.WA };
            switch (e.Column.Name)
            {
                case "COM_MC":
                    tc.TrendType = TrendTypeEnum.Real;
                    break;
                case "S01": // 실시간
                    tc.TrendType = TrendTypeEnum.Real;
                    tc.FdrId = dw_mc_id;
                    break;
                case "S02": // 일(TON)
                case "S03": // 일(T/D)
                    tc.TrendType = TrendTypeEnum.Day;
                    tc.FdrId = dw_mc_id;
                    break;
                case "S04": // 월(TON)
                case "S05": // 월(T/D)
                    tc.TrendType = TrendTypeEnum.Month;
                    tc.CompreDate = tc.CompreDate.AddMonths(-1);
                    tc.FdrId = dw_mc_id;
                    break;
                case "S07": // 당월 PEAK
                    tc.TrendType = TrendTypeEnum.CurMonth;
                    tc.CompreDate = tc.CompreDate.AddMonths(-1);
                    tc.FdrId = dw_mc_id;
                    break;
                case "S08": // 실시간
                  tc.TrendType = TrendTypeEnum.Real;
                  tc.FdrId = fw_mc_id;
                  break;
                case "S09": // 일(TON)
                case "S10": // 일(T/D)
                  tc.TrendType = TrendTypeEnum.Day;
                  tc.FdrId = fw_mc_id;
                  break;
                case "S11": // 월(TON)
                case "S12": // 월(T/D)
                  tc.TrendType = TrendTypeEnum.Month;
                  tc.CompreDate = tc.CompreDate.AddMonths(-1);
                  tc.FdrId = fw_mc_id;
                  break;
                case "S14": // 당월 PEAK
                  tc.TrendType = TrendTypeEnum.CurMonth;
                  tc.CompreDate = tc.CompreDate.AddMonths(-1);
                  tc.FdrId = fw_mc_id;
                  break;
            }

            CommonPopupService.Show(typeof(UH1070QA1_POP), "Trend View", Width: 1280, Height: 740, Parameter: tc, CloseCallback: OnCloseCallback);
        }
    }


    protected async Task OnCloseCallback(PopupResult result)
    {

        if (result.PopupResultType != PopupResultType.OK) return;
        await Task.Delay(1);

    }





}
