@{
    /*
    * 작성자명 : 김지수
    * 작성일자 : 25-01-21
    * 최종수정 : 25-02-14
    * 화면명 : FDR별 모니터링 현황
    * 프로시저 : P_HMI_ELEC_REAL_MNTR
    */
            }

@using MIT.Razor.Pages
@using MIT.Razor.Pages.Common
@using MIT.Razor.Pages.Component.DataEdits
@using MIT.Razor.Pages.Component.Grid
@using MIT.Razor.Pages.Component.Grid.RepositoryItem
@using MIT.UI.LIB.DataEdits
@using System.Data
@using static MIT.Razor.Pages.TrendCode
@inherits UH1020QA1Base

            <DxFormLayout CssClass="w-100">
                @{ /* search area */ }
    <DxFormLayoutGroup Caption="조회조건" CssClass="mit-search-area" Decoration="FormLayoutGroupDecoration.Card" ColSpanSm="12">
        <DxFormLayoutItem Caption="회사코드" ColSpanSm="12"><MitTagBox CodeId="company2" Etc0="PW" @bind-Values="ComValues"/></DxFormLayoutItem> 
    </DxFormLayoutGroup>

    @{ /* content area */ }
    <DxFormLayoutGroup Caption="FDR별 모니터링 현황" CssClass="mit-content-area" Decoration="FormLayoutGroupDecoration.Card" ColSpanSm="12">
        <DxFormLayoutItem ColSpanSm="12">
            <CommonGrid @ref=@(Grd1) CssClass="setting-program-grid"
            RowDoubleClick="OnRowDoubleClick"
            IsExportDocEnabled=false
            IsExportImageEnabled=false
            IsExportPDFEnabled=false
            IsExportXlsxEnabled=false
            ExportFileName="FDR별 모니터링 현황"
            IsShowToolBar=true>
                <DataColumnsTemplate>
                    <DxGridDataColumn Caption="공장" FieldName="FACTORY" GroupIndex="0" TextAlignment="GridTextAlignment.Center" CaptionAlignment="GridTextAlignment.Center"><CellDisplayTemplate Context="context2"><RepositoryItemTextBox CellContext="context2" ReadOnly="true" /></CellDisplayTemplate></DxGridDataColumn>
                    <DxGridDataColumn Caption="회사명" FieldName="COM_NAME" Name="COM_NAME" TextAlignment="GridTextAlignment.Center" CaptionAlignment="GridTextAlignment.Center"><CellDisplayTemplate Context="context2"><RepositoryItemTextBox CellContext="context2" ReadOnly="true" /></CellDisplayTemplate></DxGridDataColumn>
                    <DxGridDataColumn Caption="실시간(kW)" FieldName="S01" Name="S01" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center"><CellDisplayTemplate Context="context2"><RepositoryItemSpinEdit CellContext="context2" ReadOnly="true" DisplayFormat="N0" /></CellDisplayTemplate></DxGridDataColumn>
                    <DxGridDataColumn Caption="일사용(kW)" FieldName="S02" Name="S02" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center"><CellDisplayTemplate Context="context2"><RepositoryItemSpinEdit CellContext="context2" ReadOnly="true" DisplayFormat="N0" /></CellDisplayTemplate></DxGridDataColumn>
                    <DxGridDataColumn Caption="월사용(kW)" FieldName="S03" Name="S03" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center"><CellDisplayTemplate Context="context2"><RepositoryItemSpinEdit CellContext="context2" ReadOnly="true" DisplayFormat="N0" /></CellDisplayTemplate></DxGridDataColumn>
                    <DxGridDataColumn Caption="당월 PEAK(kW)" FieldName="S04" Name="S04" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center"><CellDisplayTemplate Context="context2"><RepositoryItemSpinEdit CellContext="context2" ReadOnly="true" DisplayFormat="N0" /></CellDisplayTemplate></DxGridDataColumn>
                    <DxGridDataColumn Caption="당월 역율(%)" FieldName="S05" Name="S05" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center"><CellDisplayTemplate Context="context2"><RepositoryItemSpinEdit CellContext="context2" ReadOnly="true" DisplayFormat="N1" /></CellDisplayTemplate></DxGridDataColumn>
                </DataColumnsTemplate>
            </CommonGrid>
        </DxFormLayoutItem>
    </DxFormLayoutGroup>
</DxFormLayout>

<style>

</style>
@code {
    private void OnRowDoubleClick(GridRowClickEventArgs e)
    {
        if (CommonPopupService != null)
        {
            // 소계 합계는 눌러도 안나오게..
            var com_name = (e.Grid.GetRowValue(e.VisibleIndex, "COM_NAME") + "");
            var factory_name = (e.Grid.GetRowValue(e.VisibleIndex, "FACTORY") + "");
            if (com_name == "소계" || factory_name == "합계") return;

            // mc..
            var mc_id = (e.Grid.GetRowValue(e.VisibleIndex, "MC_ID") + "");


            // 이걸로 구분
            // e.Column


            TrendCode tc = new TrendCode() { ComId = "", FdrId = mc_id };
            switch (e.Column.Name)
            {
                case "COM_NAME":
                    tc.TrendType = TrendTypeEnum.Real;
                    break;
                case "S01": // 실시간
                    tc.TrendType = TrendTypeEnum.Real;
                    break;
                case "S02": // 일
                    tc.TrendType = TrendTypeEnum.Day;
                    break;
                case "S03": // 월
                    tc.TrendType = TrendTypeEnum.Month;
                    break;
                case "S04": // 당월 peak
                    tc.TrendType = TrendTypeEnum.CurMonth;
                    break;
                case "S05": // 당월 역율
                    tc.TrendType = TrendTypeEnum.CurMonthRe;
                    break;
            }
            CommonPopupService.Show(typeof(UH1070QA1_POP), "Trend View", Width: 1280, Height: 740, Parameter: tc, CloseCallback: OnCloseCallback);
        }
    }


    protected async Task OnCloseCallback(PopupResult result)
    {
        if (result.PopupResultType != PopupResultType.OK) return;
        await Task.Delay(1);

    }





}