@using MIT.Razor.Pages.Component.Charts
@using MIT.Razor.Pages.Component.Grid
@using MIT.Razor.Pages.Component.Grid.RepositoryItem
@using MIT.Razor.Pages.Component.DataEdits
@using MIT.UI.LIB.DataEdits
@using MIT.UI.LIB.Grid.RepositoryItem
@using MIT.UI.UMS
@using System.Data
@using System.Linq
@using static MIT.Razor.Pages.TrendCode

@inherits US2210QA1Base
@{/*
    * 작성자명 : quristyle
    * 작성일자 : 25-02-05
    * 최종수정 : 25-02-05
    * 화면ID : US2210QA1
    * 화면명 : 용수 시간대별 사용량 현황
           * 프로시저 : P_HMI_USE_DAYWATTIME_SELECT01
    */
}
<DxFormLayout CssClass="w-100">    
    @{ /* search area */ }
    <DxFormLayoutGroup Caption="조회조건" CssClass="mit-search-area" Decoration="FormLayoutGroupDecoration.Card" ColSpanSm="12">
        <DxFormLayoutItem Caption="조회일" ColSpanSm="4"><CommonDateEdit @ref="@DATE"/></DxFormLayoutItem>
        <DxFormLayoutItem Caption="수용가" ColSpanSm="4">
            @if (isHanju)
            {
                <MitCombo CodeId="company2" Etc0="WA" @bind-Value="@COM_ID" SearchMode="ListSearchMode.AutoSearch" SearchFilterCondition="ListSearchFilterCondition.Contains" IsAll="true" />
            }
            else
            {
                <CommonTextBox @ref=@ComText ReadOnly="true" />
            }
        </DxFormLayoutItem>
    </DxFormLayoutGroup>
    @{ /* content area */ }

    <DxFormLayoutGroup Caption="용수 시간대별 사용량 현황" CssClass="mit-content-area" Decoration="FormLayoutGroupDecoration.Card" ColSpanSm="12">
        <DxFormLayoutItem ColSpanSm="12"  >
            <CommonGrid @ref="Grd1" ControlHeight="400" CssClass="mit-grid_test"
            RowDoubleClick="OnRowDoubleClick"
            IsExportDocEnabled=false
            IsExportImageEnabled=false
            IsExportPDFEnabled=false
            IsExportXlsxEnabled=false
            ExportFileName="용수 시간대별 사용량 현황"
            IsShowToolBar=true>
                <DataColumnsTemplate>
                    <DxGridDataColumn Caption="구분" FieldName="HH" TextAlignment="GridTextAlignment.Center" CaptionAlignment="GridTextAlignment.Center"><CellDisplayTemplate Context="context2"><RepositoryItemTextBox CellContext="context2" ReadOnly="true" /></CellDisplayTemplate></DxGridDataColumn>
                    <DxGridBandColumn Caption="순수" CaptionAlignment="GridTextAlignment.Center">
                        <Columns>
                            <DxGridDataColumn Caption="T/D" FieldName="SOL_01" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center"><CellDisplayTemplate Context="context2"><RepositoryItemSpinEdit CellContext="context2" ReadOnly="true" DisplayFormat="N0" /></CellDisplayTemplate></DxGridDataColumn>
                            <DxGridDataColumn Caption="TON" FieldName="SOL_02" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center"><CellDisplayTemplate Context="context2"><RepositoryItemSpinEdit CellContext="context2" ReadOnly="true" DisplayFormat="N0" /></CellDisplayTemplate></DxGridDataColumn>
                        </Columns>
                    </DxGridBandColumn>
                    <DxGridBandColumn Caption="여과수" CaptionAlignment="GridTextAlignment.Center">
                        <Columns>
                            <DxGridDataColumn Caption="T/D" FieldName="SOL_03" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center"><CellDisplayTemplate Context="context2"><RepositoryItemSpinEdit CellContext="context2" ReadOnly="true" DisplayFormat="N0" /></CellDisplayTemplate></DxGridDataColumn>
                            <DxGridDataColumn Caption="TON" FieldName="SOL_04" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center"><CellDisplayTemplate Context="context2"><RepositoryItemSpinEdit CellContext="context2" ReadOnly="true" DisplayFormat="N0" /></CellDisplayTemplate></DxGridDataColumn>
                        </Columns>
                    </DxGridBandColumn>
                    <DxGridBandColumn Caption="응축수(순수)" CaptionAlignment="GridTextAlignment.Center" Visible="@VisibleFRDW">
                        <Columns>
                            <DxGridDataColumn Caption="T/D" FieldName="SOL_05" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center"><CellDisplayTemplate Context="context2"><RepositoryItemSpinEdit CellContext="context2" ReadOnly="true" DisplayFormat="N0" /></CellDisplayTemplate></DxGridDataColumn>
                            <DxGridDataColumn Caption="TON" FieldName="SOL_06" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center"><CellDisplayTemplate Context="context2"><RepositoryItemSpinEdit CellContext="context2" ReadOnly="true" DisplayFormat="N0" /></CellDisplayTemplate></DxGridDataColumn>
                        </Columns>
                    </DxGridBandColumn>
                    <DxGridBandColumn Caption="응축수(여과수)" CaptionAlignment="GridTextAlignment.Center" Visible="@VisibleFRFW">
                        <Columns>
                            <DxGridDataColumn Caption="T/D" FieldName="SOL_07" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center"><CellDisplayTemplate Context="context2"><RepositoryItemSpinEdit CellContext="context2" ReadOnly="true" DisplayFormat="N0" /></CellDisplayTemplate></DxGridDataColumn>
                            <DxGridDataColumn Caption="TON" FieldName="SOL_08" TextAlignment="GridTextAlignment.Right" CaptionAlignment="GridTextAlignment.Center"><CellDisplayTemplate Context="context2"><RepositoryItemSpinEdit CellContext="context2" ReadOnly="true" DisplayFormat="N0" /></CellDisplayTemplate></DxGridDataColumn>
                        </Columns>
                    </DxGridBandColumn>
                </DataColumnsTemplate>
            </CommonGrid>
        </DxFormLayoutItem>
        @* <MitChartLine HeightStr="200px" XName="HH" YTitles="일사용량 TON,일사용량 T/D" YNames="HI_USEQTY,H_USEQTY" IsShowToolTip="true" IsShowLegend="true" @ref="Chart1"></MitChartLine> *@
    </DxFormLayoutGroup>



</DxFormLayout>
@code {
    private void OnRowDoubleClick(GridRowClickEventArgs e)
    {
        if (CommonPopupService != null)
        {


            // 수용가..
            var com_id = isHanju ? COM_ID : USER_ID;


            // 이걸로 구분
            // e.Column



            TrendCode tc = new TrendCode() { 
                ComId = com_id, 
                FdrId = "", 
                TrendType = TrendTypeEnum.Real, 
                CompreDate = DateTime.ParseExact(DATE.EditValue,"yyyy-MM-dd",null).AddDays(-1),
                GaugeType = GAUGE_TYPE.WA
            };

            CommonPopupService.Show(typeof(UH1070QA1_POP), "Trend View", Width: 1280, Height: 740, Parameter: tc, CloseCallback: OnCloseCallback);
        }
    }


    protected async Task OnCloseCallback(PopupResult result)
    {
        if (result.PopupResultType != PopupResultType.OK) return;
        await Task.Delay(1);

    }





}